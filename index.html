<div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">
    TIEMPO: <span id="timer">0.000</span>s
</div>

<div id="displayBox">Esperando inicio...</div>

<div class="controls">
    <button id="startBtn" onclick="startTest()">INICIAR TEST 1 (SISTEMA COMÚN)</button>
    <button id="finishBtn" onclick="finishTest()" style="display:none;">LISTO / DETENER RELOJ</button>
</div>

<script>
    let startTime, timerInterval;
    let currentStep = 1;
    let resultsLog = [];

    const textComun = "La lectura tradicional implica un salto brusco al final de cada renglón impreso.\nEste movimiento mecánico genera un vacío cognitivo llamado sacada de retorno.\nEl cerebro debe reubicar el foco visual perdiendo milisegundos en cada proceso.\nLa fatiga muscular ciliar aumenta proporcionalmente a la densidad del texto.";

    const textSLER = "La lectura tradicional implica un salto brusco al final de cada renglón- \n-impreso. Este movimiento mecánico genera un vacío cognitivo llamado- \n-sacada de retorno. El cerebro debe reubicar el foco visual perdiendo- \n-milisegundos en cada proceso. La fatiga muscular ciliar aumenta-";

    function startTest() {
        // 1. Mostrar texto
        document.getElementById('displayBox').innerText = (currentStep === 1) ? textComun : textSLER;
        
        // 2. Gestión de botones
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('finishBtn').style.display = 'block';
        
        // 3. Iniciar Reloj
        startTime = performance.now();
        timerInterval = setInterval(updateTimer, 10); // Actualiza cada 10ms
    }

    function updateTimer() {
        const currentTime = performance.now();
        const diff = ((currentTime - startTime) / 1000).toFixed(3);
        document.getElementById('timer').innerText = diff;
    }

    function finishTest() {
        // 1. Detener Reloj
        clearInterval(timerInterval);
        const finalTime = document.getElementById('timer').innerText;
        resultsLog.push(finalTime);

        // 2. Registrar Resultados
        const resDiv = document.getElementById('results');
        resDiv.innerHTML += `<div><strong>TEST ${currentStep}:</strong> ${finalTime} segundos.</div>`;

        // 3. Lógica de pasos
        if (currentStep === 1) {
            currentStep = 2;
            document.getElementById('displayBox').innerText = "Test 1 completado. Prepárese para el Sistema SLER.";
            document.getElementById('startBtn').innerText = "INICIAR TEST 2 (SISTEMA SLER)";
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('finishBtn').style.display = 'none';
            document.getElementById('timer').innerText = "0.000";
        } else {
            const mejora = (((resultsLog[0] - resultsLog[1]) / resultsLog[0]) * 100).toFixed(1);
            resDiv.innerHTML += `<br><div style="color:green;"><strong>RESULTADO FINAL:</strong> El sistema SLER optimizó la asimilación en un ${mejora}%.</div>`;
            document.getElementById('displayBox').innerText = "Protocolo finalizado exitosamente.";
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('finishBtn').style.display = 'none';
        }
    }
</script>
